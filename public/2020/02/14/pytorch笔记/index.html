<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>pytorch 笔记 | Reborn</title><meta name="description" content="pytorch 笔记"><meta name="keywords" content="python,pytorch,DL"><meta name="author" content="Reborn"><meta name="copyright" content="Reborn"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="baidu-site-verification" content="Vkh2aRZcUl"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="pytorch 笔记"><meta name="twitter:description" content="pytorch 笔记"><meta name="twitter:image" content="https://i.loli.net/2020/02/14/YXEOI3Txj7HJqRa.jpg"><meta property="og:type" content="article"><meta property="og:title" content="pytorch 笔记"><meta property="og:url" content="https://reborn8888.github.io/2020/02/14/pytorch%E7%AC%94%E8%AE%B0/"><meta property="og:site_name" content="Reborn"><meta property="og:description" content="pytorch 笔记"><meta property="og:image" content="https://i.loli.net/2020/02/14/YXEOI3Txj7HJqRa.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = '2'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"><link rel="canonical" href="https://reborn8888.github.io/2020/02/14/pytorch%E7%AC%94%E8%AE%B0/"><link rel="prev" title="git Issues" href="https://reborn8888.github.io/2020/03/02/gitIssues/"><link rel="next" title="sklearn 笔记" href="https://reborn8888.github.io/2020/02/14/sklearn%E7%AC%94%E8%AE%B0/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: false,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 5.4.0"><link rel="stylesheet" href="\assets\css\APlayer.min.css" class="aplayer-style-marker">
<script src="\assets\js\APlayer.min.js" class="aplayer-script-marker"></script>
<script src="\assets\js\Meting.min.js" class="meting-script-marker"></script>
</head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Reborn</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div></span><span class="pull_right" id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://rebornas.blob.core.windows.net/rebornhome/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">33</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">34</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">3</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> About</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E5%AE%89%E8%A3%85pytorch-with-cuda-100"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text"> 安装PyTorch with CUDA 10.0</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E9%80%89%E6%8B%A9%E8%BF%90%E7%AE%97%E8%AE%BE%E5%A4%87cpugpu"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text"> 选择运算设备(CPU&#x2F;GPU)</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-dataset"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text"> 自定义 Dataset</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-loss"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text"> 自定义 Loss</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#averagemeter"><span class="toc_mobile_items-number">5.</span> <span class="toc_mobile_items-text"> AverageMeter()</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#%E6%97%B6%E9%97%B4%E8%BD%AC%E6%8D%A2"><span class="toc_mobile_items-number">6.</span> <span class="toc_mobile_items-text"> 时间转换</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#topk-accuracy"><span class="toc_mobile_items-number">7.</span> <span class="toc_mobile_items-text"> TopK Accuracy</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#accuracyloss-%E6%9B%B2%E7%BA%BF"><span class="toc_mobile_items-number">8.</span> <span class="toc_mobile_items-text"> Accuracy&#x2F;Loss 曲线</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#finetune-torchvisionmodels"><span class="toc_mobile_items-number">9.</span> <span class="toc_mobile_items-text"> Finetune torchvision.models</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#model-summary"><span class="toc_mobile_items-number">10.</span> <span class="toc_mobile_items-text"> Model summary</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#trainvalidate-template"><span class="toc_mobile_items-number">11.</span> <span class="toc_mobile_items-text"> Train&#x2F;Validate Template</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#evaluation-template"><span class="toc_mobile_items-number">12.</span> <span class="toc_mobile_items-text"> Evaluation Template</span></a></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%89%E8%A3%85pytorch-with-cuda-100"><span class="toc-number">1.</span> <span class="toc-text"> 安装PyTorch with CUDA 10.0</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E8%BF%90%E7%AE%97%E8%AE%BE%E5%A4%87cpugpu"><span class="toc-number">2.</span> <span class="toc-text"> 选择运算设备(CPU&#x2F;GPU)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-dataset"><span class="toc-number">3.</span> <span class="toc-text"> 自定义 Dataset</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-loss"><span class="toc-number">4.</span> <span class="toc-text"> 自定义 Loss</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#averagemeter"><span class="toc-number">5.</span> <span class="toc-text"> AverageMeter()</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E8%BD%AC%E6%8D%A2"><span class="toc-number">6.</span> <span class="toc-text"> 时间转换</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#topk-accuracy"><span class="toc-number">7.</span> <span class="toc-text"> TopK Accuracy</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#accuracyloss-%E6%9B%B2%E7%BA%BF"><span class="toc-number">8.</span> <span class="toc-text"> Accuracy&#x2F;Loss 曲线</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#finetune-torchvisionmodels"><span class="toc-number">9.</span> <span class="toc-text"> Finetune torchvision.models</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#model-summary"><span class="toc-number">10.</span> <span class="toc-text"> Model summary</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#trainvalidate-template"><span class="toc-number">11.</span> <span class="toc-text"> Train&#x2F;Validate Template</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#evaluation-template"><span class="toc-number">12.</span> <span class="toc-text"> Evaluation Template</span></a></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://i.loli.net/2020/02/14/YXEOI3Txj7HJqRa.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">pytorch 笔记</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 发表于 2020-02-14<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> 更新于 2020-09-21</time><span class="post-meta__separator">|</span><span><i class="fa fa-inbox post-meta__icon fa-fw" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></span><div class="post-meta-wordcount"><i class="fa fa-file-word-o post-meta__icon fa-fw" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">2.6k</span><span class="post-meta__separator">|</span><i class="fa fa-clock-o post-meta__icon fa-fw" aria-hidden="true"></i><span>阅读时长: 15 分钟</span><div class="post-meta-pv-cv"><span class="post-meta__separator">|</span><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>阅读量:</span><span id="busuanzi_value_page_pv"></span></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><html><head>
    </head><body><div id="aplayer-klNnUZmA" class="aplayer aplayer-tag-marker meting-tag-marker" data-id="1348625245" data-server="netease" data-type="song" data-mode="circulation" data-autoplay="true" data-mutex="false" data-listmaxheight="340px" data-preload="auto" data-theme="#ad7a86"></div>
<h1 id="安装pytorch-with-cuda-100"><a class="markdownIt-Anchor" href="#安装pytorch-with-cuda-100"></a> 安装PyTorch with CUDA 10.0</h1>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">bash</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conda install pytorch==1.2.0 torchvision==0.4.0 cudatoolkit=10.0 -c pytorch</span><br><span class="line">conda install cudnn</span><br></pre></td></tr></tbody></table></figure></div>
<h1 id="选择运算设备cpugpu"><a class="markdownIt-Anchor" href="#选择运算设备cpugpu"></a> 选择运算设备(CPU/GPU)</h1>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">select_device</span><span class="params">(device=<span class="string">''</span>, apex=False, batch_size=None)</span>:</span></span><br><span class="line">    <span class="comment"># device = 'cpu' or '0' or '0,1,2,3'</span></span><br><span class="line">    cpu_request = device.lower() == <span class="string">'cpu'</span></span><br><span class="line">    <span class="keyword">if</span> device <span class="keyword">and</span> <span class="keyword">not</span> cpu_request:  <span class="comment"># if device requested other than 'cpu'</span></span><br><span class="line">        os.environ[<span class="string">'CUDA_VISIBLE_DEVICES'</span>] = device  <span class="comment"># set environment variable</span></span><br><span class="line">        <span class="keyword">assert</span> torch.cuda.is_available(), <span class="string">'CUDA unavailable, invalid device %s requested'</span> % device  <span class="comment"># check availablity</span></span><br><span class="line"></span><br><span class="line">    cuda = <span class="literal">False</span> <span class="keyword">if</span> cpu_request <span class="keyword">else</span> torch.cuda.is_available()</span><br><span class="line">    <span class="keyword">if</span> cuda:</span><br><span class="line">        c = <span class="number">1024</span> ** <span class="number">2</span>  <span class="comment"># bytes to MB</span></span><br><span class="line">        ng = torch.cuda.device_count()</span><br><span class="line">        <span class="keyword">if</span> ng > <span class="number">1</span> <span class="keyword">and</span> batch_size:  <span class="comment"># check that batch_size is compatible with device_count</span></span><br><span class="line">            <span class="keyword">assert</span> batch_size % ng == <span class="number">0</span>, <span class="string">'batch-size %g not multiple of GPU count %g'</span> % (batch_size, ng)</span><br><span class="line">        x = [torch.cuda.get_device_properties(i) <span class="keyword">for</span> i <span class="keyword">in</span> range(ng)]</span><br><span class="line">        s = <span class="string">'Using CUDA '</span> + (<span class="string">'Apex '</span> <span class="keyword">if</span> apex <span class="keyword">else</span> <span class="string">''</span>)  <span class="comment"># apex for mixed precision https://github.com/NVIDIA/apex</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, ng):</span><br><span class="line">            <span class="keyword">if</span> i == <span class="number">1</span>:</span><br><span class="line">                s = <span class="string">' '</span> * len(s)</span><br><span class="line">            print(<span class="string">"%sdevice%g _CudaDeviceProperties(name='%s', total_memory=%dMB)"</span> %</span><br><span class="line">                  (s, i, x[i].name, x[i].total_memory / c))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">'Using CPU'</span>)</span><br><span class="line"></span><br><span class="line">    print(<span class="string">''</span>)  <span class="comment"># skip a line</span></span><br><span class="line">    <span class="keyword">return</span> torch.device(<span class="string">'cuda:0'</span> <span class="keyword">if</span> cuda <span class="keyword">else</span> <span class="string">'cpu'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ===========================================================================================</span></span><br><span class="line"></span><br><span class="line">device = select_device(device=<span class="string">'cpu'</span>)</span><br><span class="line"><span class="meta">>>> </span>Using CPU</span><br><span class="line"></span><br><span class="line">device = select_device(device=<span class="string">'0'</span>)</span><br><span class="line"><span class="meta">>>> </span>Using CUDA device0 _CudaDeviceProperties(name=<span class="string">'GeForce GTX 1060 6GB'</span>, total_memory=<span class="number">6144</span>MB)</span><br></pre></td></tr></tbody></table></figure></div>
<h1 id="自定义-dataset"><a class="markdownIt-Anchor" href="#自定义-dataset"></a> 自定义 Dataset</h1>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch.utils.data <span class="keyword">import</span> DataLoader</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myDataset</span><span class="params">(Dataset)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, images, labels, classes=None, transform=None, to_onehot=False)</span>:</span></span><br><span class="line">        self.images = images</span><br><span class="line">        self.labels = labels</span><br><span class="line">        self.transform = transform</span><br><span class="line">        self.classes = classes</span><br><span class="line">        self.num_classes = len(self.classes)</span><br><span class="line">        self.to_onthot = to_onthot</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">int_to_onehot</span><span class="params">(self, label)</span>:</span></span><br><span class="line">        label = torch.unsqueeze(torch.unsqueeze(label, <span class="number">0</span>), <span class="number">1</span>)</span><br><span class="line">        label = torch.zeros(<span class="number">1</span>, self.num_classes).scatter_(<span class="number">1</span>, label, <span class="number">1</span>)</span><br><span class="line">        label = torch.squeeze(label)</span><br><span class="line">        <span class="keyword">return</span> label</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> len(self.images)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, index)</span>:</span></span><br><span class="line">        image, label = self.images[index], self.labels[index]</span><br><span class="line">        <span class="keyword">if</span>(self.onehot):</span><br><span class="line">            label = self.int_to_onehot(label)</span><br><span class="line">        <span class="keyword">if</span>(self.transform):</span><br><span class="line">            image = self.transform(Image.fromarray(np.uint8(image)))</span><br><span class="line">        <span class="keyword">return</span> image, label</span><br><span class="line"></span><br><span class="line"><span class="comment"># ===========================================================================================</span></span><br><span class="line"></span><br><span class="line">myTransform = transforms.Compose([</span><br><span class="line">    transforms.ToTensor(),</span><br><span class="line">])</span><br><span class="line">trainDataset = myDataset(trainImage, torch.Tensor(trainLabel).long(), classes, transform=myTransform, to_onehot=<span class="literal">True</span>)</span><br><span class="line">trainLoader = DataLoader(trainDataset, batch_size=trainBS, shuffle=<span class="literal">True</span>, num_workers=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">testDataset = myDataset(testImage, torch.Tensor(testLabel).long(), classes, transform=myTransform, to_onehot=<span class="literal">True</span>)</span><br><span class="line">testLoader = DataLoader(testDataset, batch_size=testBS, shuffle=<span class="literal">False</span>, num_workers=<span class="number">1</span>)</span><br></pre></td></tr></tbody></table></figure></div>
<h1 id="自定义-loss"><a class="markdownIt-Anchor" href="#自定义-loss"></a> 自定义 Loss</h1>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myLoss</span><span class="params">(nn.Module)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">		super(myLoss, self).__init__()</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, pred, truth)</span>:</span></span><br><span class="line">		pred = F.log_softmax(pred, <span class="number">1</span>)</span><br><span class="line">		loss = -torch.sum(pred * truth, <span class="number">1</span>)</span><br><span class="line">		<span class="keyword">return</span> loss.mean()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ===========================================================================================</span></span><br><span class="line"></span><br><span class="line">criterion = myLoss()</span><br></pre></td></tr></tbody></table></figure></div>
<h1 id="averagemeter"><a class="markdownIt-Anchor" href="#averagemeter"></a> AverageMeter()</h1>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AverageMeter</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""Computes and stores the average and current value"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.reset()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reset</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.avg = <span class="number">0</span></span><br><span class="line">        self.sum = <span class="number">0</span></span><br><span class="line">        self.count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self, val, n=<span class="number">1</span>)</span>:</span></span><br><span class="line">        self.sum += val * n                 <span class="comment"># 元素总和</span></span><br><span class="line">        self.count += n                     <span class="comment"># 元素总数</span></span><br><span class="line">        self.avg = self.sum / self.count    <span class="comment"># 平均值</span></span><br></pre></td></tr></tbody></table></figure></div>
<h1 id="时间转换"><a class="markdownIt-Anchor" href="#时间转换"></a> 时间转换</h1>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert_secs2time</span><span class="params">(epoch_time)</span>:</span></span><br><span class="line">    need_hour = int(epoch_time / <span class="number">3600</span>)</span><br><span class="line">    need_mins = int((epoch_time - <span class="number">3600</span>*need_hour) / <span class="number">60</span>)</span><br><span class="line">    need_secs = int(epoch_time - <span class="number">3600</span>*need_hour - <span class="number">60</span>*need_mins)</span><br><span class="line">    <span class="keyword">return</span> need_hour, need_mins, need_secs</span><br></pre></td></tr></tbody></table></figure></div>
<h1 id="topk-accuracy"><a class="markdownIt-Anchor" href="#topk-accuracy"></a> TopK Accuracy</h1>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">accuracy</span><span class="params">(output, target, topk=<span class="params">(<span class="number">1</span>,)</span>)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Computes the precision@k for the specified values of k</span></span><br><span class="line"><span class="string">    output (tensor): model output</span></span><br><span class="line"><span class="string">    target (tensor): ground truth label (not onehot)</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    maxk = max(topk)</span><br><span class="line">    batch_size = target.size(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    _, pred = output.topk(maxk, <span class="number">1</span>, <span class="literal">True</span>, <span class="literal">True</span>)</span><br><span class="line">    pred = pred.t()</span><br><span class="line">    correct = pred.eq(target.view(<span class="number">1</span>, <span class="number">-1</span>).expand_as(pred))</span><br><span class="line"></span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> topk:</span><br><span class="line">        correct_k = correct[:k].view(<span class="number">-1</span>).float().sum(<span class="number">0</span>)</span><br><span class="line">        res.append(correct_k)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment"># ===========================================================================================</span></span><br><span class="line"></span><br><span class="line">outputs = net(inputs)</span><br><span class="line">prec1, prec5 = accuracy(outputs, torch.argmax(labels, <span class="number">1</span>), topk=(<span class="number">1</span>, <span class="number">5</span>))</span><br></pre></td></tr></tbody></table></figure></div>
<h1 id="accuracyloss-曲线"><a class="markdownIt-Anchor" href="#accuracyloss-曲线"></a> Accuracy/Loss 曲线</h1>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_acc_loss</span><span class="params">(log, type, modelPath, prefix=<span class="string">''</span>, suffix=<span class="string">''</span>, printFlag=False)</span>:</span></span><br><span class="line">    trainAcc = log[<span class="string">'acc'</span>][<span class="string">'train'</span>]</span><br><span class="line">    trainLoss = log[<span class="string">'loss'</span>][<span class="string">'train'</span>]</span><br><span class="line">    valAcc = log[<span class="string">'acc'</span>][<span class="string">'val'</span>]</span><br><span class="line">    valLoss = log[<span class="string">'loss'</span>][<span class="string">'val'</span>]</span><br><span class="line">    <span class="keyword">if</span>(type == <span class="string">'loss'</span>):</span><br><span class="line">        plt.figure(figsize=(<span class="number">7</span>, <span class="number">5</span>))</span><br><span class="line">        plt.plot(trainLoss, label=<span class="string">'Train_loss'</span>)</span><br><span class="line">        plt.plot(valLoss, label=<span class="string">'Test_loss'</span>)</span><br><span class="line">        plt.title(<span class="string">'Epoch - Loss'</span>)</span><br><span class="line">        plt.xlabel(<span class="string">'Epoch'</span>)</span><br><span class="line">        plt.ylabel(<span class="string">'Loss'</span>)</span><br><span class="line">        plt.legend()</span><br><span class="line">        figName = <span class="string">'{}loss{}.png'</span>.format(prefix, suffix)</span><br><span class="line">    <span class="keyword">elif</span>(type == <span class="string">'accuracy'</span>):</span><br><span class="line">        plt.figure(figsize=(<span class="number">7</span>, <span class="number">5</span>))</span><br><span class="line">        plt.plot(trainAcc, label=<span class="string">'Train_acc'</span>)</span><br><span class="line">        plt.plot(valAcc, label=<span class="string">'Test_acc'</span>)</span><br><span class="line">        plt.title(<span class="string">'Epoch - Acuracy'</span>)</span><br><span class="line">        plt.xlabel(<span class="string">'Epoch'</span>)</span><br><span class="line">        plt.ylabel(<span class="string">'Accuracy'</span>)</span><br><span class="line">    <span class="comment">#         plt.ylim(0, 1.01)</span></span><br><span class="line">        plt.legend()</span><br><span class="line">        figName = <span class="string">'{}accuracy{}.png'</span>.format(prefix, suffix)</span><br><span class="line">    <span class="keyword">elif</span>(type == <span class="string">'both'</span>):</span><br><span class="line">        fig, ax1 = plt.subplots(figsize=(<span class="number">7</span>, <span class="number">5</span>)) <span class="comment"># 分双轴分别画loss和acc</span></span><br><span class="line">        ax2 = plt.twinx()</span><br><span class="line">        ax1.set_xlabel(<span class="string">'Epoch'</span>)</span><br><span class="line">        ax1.set_ylabel(<span class="string">'Loss'</span>)</span><br><span class="line">        ax2.set_ylabel(<span class="string">'Accuracy'</span>)</span><br><span class="line">        plt.ylim(<span class="number">0</span>, <span class="number">1.01</span>)</span><br><span class="line">        plt.title(<span class="string">'Loss & Accuracy'</span>)</span><br><span class="line"></span><br><span class="line">        l_trainLoss, = ax1.plot(trainLoss)</span><br><span class="line">        l_testLoss, = ax1.plot(valLoss)</span><br><span class="line">        l_trainAcc, = ax2.plot(trainAcc, marker=<span class="string">'x'</span>)</span><br><span class="line">        l_testAcc, = ax2.plot(valAcc, marker=<span class="string">'x'</span>)</span><br><span class="line">        plt.legend([l_trainLoss, l_testLoss, l_trainAcc, l_testAcc],</span><br><span class="line">                  [<span class="string">'Train_loss'</span>, <span class="string">'Test_loss'</span>, <span class="string">'Train_acc'</span>, <span class="string">'Test_acc'</span>])</span><br><span class="line">        figName = <span class="string">'{}loss_accuracy{}.png'</span>.format(prefix, suffix)</span><br><span class="line"></span><br><span class="line">    plt.grid(linewidth=<span class="number">1</span>, linestyle=<span class="string">'-.'</span>)</span><br><span class="line">    plt.savefig(os.path.abspath(figName), dpi=<span class="number">200</span>, bbox_inches=<span class="string">'tight'</span>)</span><br><span class="line">    <span class="keyword">if</span>(printFlag):</span><br><span class="line">        print(<span class="string">"Figure saved to : {}"</span>.format(os.path.abspath(figName)))</span><br><span class="line">    plt.close()</span><br></pre></td></tr></tbody></table></figure></div>
<blockquote>
<p>loss_accuracy.png 如下<br>
<img alt data-src="https://i.loli.net/2020/04/09/19laYwPiVAn26ZX.png" class="lazyload"></p>
</blockquote>
<h1 id="finetune-torchvisionmodels"><a class="markdownIt-Anchor" href="#finetune-torchvisionmodels"></a> Finetune torchvision.models</h1>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取pytorch库模型</span></span><br><span class="line">net = models.resnet18(pretrained=<span class="literal">True</span>)</span><br><span class="line"><span class="comment"># 修改池化层为全局平均池化</span></span><br><span class="line">net.avgpool = nn.AdaptiveAvgPool2d((<span class="number">1</span>, <span class="number">1</span>))</span><br><span class="line"><span class="comment"># 修改最后一层全连接层</span></span><br><span class="line">fc_features = net.fc.in_features</span><br><span class="line">net.fc = nn.Linear(fc_features, len(classes))</span><br><span class="line"><span class="comment"># 将模型加载到GPU中</span></span><br><span class="line">net = net.cuda()</span><br></pre></td></tr></tbody></table></figure></div>
<h1 id="model-summary"><a class="markdownIt-Anchor" href="#model-summary"></a> Model summary</h1>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">from</span> torch.autograd <span class="keyword">import</span> Variable</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">summary</span><span class="params">(model, input_size, batch_size=<span class="number">-1</span>, device=<span class="string">"cuda"</span>)</span>:</span></span><br><span class="line">    outString = <span class="string">""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">register_hook</span><span class="params">(module)</span>:</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">hook</span><span class="params">(module, input, output)</span>:</span></span><br><span class="line">            class_name = str(module.__class__).split(<span class="string">"."</span>)[<span class="number">-1</span>].split(<span class="string">"'"</span>)[<span class="number">0</span>]</span><br><span class="line">            module_idx = len(summary)</span><br><span class="line"></span><br><span class="line">            m_key = <span class="string">"%s-%i"</span> % (class_name, module_idx + <span class="number">1</span>)</span><br><span class="line">            summary[m_key] = OrderedDict()</span><br><span class="line">            summary[m_key][<span class="string">"input_shape"</span>] = list(input[<span class="number">0</span>].size())</span><br><span class="line">            summary[m_key][<span class="string">"input_shape"</span>][<span class="number">0</span>] = batch_size</span><br><span class="line">            <span class="keyword">if</span> isinstance(output, (list, tuple)):</span><br><span class="line">                summary[m_key][<span class="string">"output_shape"</span>] = [</span><br><span class="line">                    [<span class="number">-1</span>] + list(o.size())[<span class="number">1</span>:] <span class="keyword">for</span> o <span class="keyword">in</span> output</span><br><span class="line">                ]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                summary[m_key][<span class="string">"output_shape"</span>] = list(output.size())</span><br><span class="line">                summary[m_key][<span class="string">"output_shape"</span>][<span class="number">0</span>] = batch_size</span><br><span class="line"></span><br><span class="line">            params = <span class="number">0</span></span><br><span class="line">            <span class="keyword">if</span> hasattr(module, <span class="string">"weight"</span>) <span class="keyword">and</span> hasattr(module.weight, <span class="string">"size"</span>):</span><br><span class="line">                params += torch.prod(torch.LongTensor(list(module.weight.size())))</span><br><span class="line">                summary[m_key][<span class="string">"trainable"</span>] = module.weight.requires_grad</span><br><span class="line">            <span class="keyword">if</span> hasattr(module, <span class="string">"bias"</span>) <span class="keyword">and</span> hasattr(module.bias, <span class="string">"size"</span>):</span><br><span class="line">                params += torch.prod(torch.LongTensor(list(module.bias.size())))</span><br><span class="line">            summary[m_key][<span class="string">"nb_params"</span>] = params</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">            <span class="keyword">not</span> isinstance(module, nn.Sequential)</span><br><span class="line">            <span class="keyword">and</span> <span class="keyword">not</span> isinstance(module, nn.ModuleList)</span><br><span class="line">            <span class="keyword">and</span> <span class="keyword">not</span> (module == model)</span><br><span class="line">        ):</span><br><span class="line">            hooks.append(module.register_forward_hook(hook))</span><br><span class="line"></span><br><span class="line">    device = device.lower()</span><br><span class="line">    <span class="keyword">assert</span> device <span class="keyword">in</span> [</span><br><span class="line">        <span class="string">"cuda"</span>,</span><br><span class="line">        <span class="string">"cpu"</span>,</span><br><span class="line">    ], <span class="string">"Input device is not valid, please specify 'cuda' or 'cpu'"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> device == <span class="string">"cuda"</span> <span class="keyword">and</span> torch.cuda.is_available():</span><br><span class="line">        dtype = torch.cuda.FloatTensor</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        dtype = torch.FloatTensor</span><br><span class="line"></span><br><span class="line">    <span class="comment"># multiple inputs to the network</span></span><br><span class="line">    <span class="keyword">if</span> isinstance(input_size, tuple):</span><br><span class="line">        input_size = [input_size]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># batch_size of 2 for batchnorm</span></span><br><span class="line">    x = [torch.rand(<span class="number">2</span>, *in_size).type(dtype) <span class="keyword">for</span> in_size <span class="keyword">in</span> input_size]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># create properties</span></span><br><span class="line">    summary = OrderedDict()</span><br><span class="line">    hooks = []</span><br><span class="line"></span><br><span class="line">    <span class="comment"># register hook</span></span><br><span class="line">    model.apply(register_hook)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># make a forward pass</span></span><br><span class="line">    model(*x)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># remove these hooks</span></span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> hooks:</span><br><span class="line">        h.remove()</span><br><span class="line"></span><br><span class="line">    outString += <span class="string">"{}\n"</span>.format(<span class="string">"----------------------------------------------------------------"</span>)</span><br><span class="line">    line_new = <span class="string">"{:>20}  {:>25} {:>15}"</span>.format(<span class="string">"Layer (type)"</span>, <span class="string">"Output Shape"</span>, <span class="string">"Param #"</span>)</span><br><span class="line">    outString += <span class="string">"{}\n"</span>.format(line_new)</span><br><span class="line">    outString += <span class="string">"{}\n"</span>.format(<span class="string">"================================================================"</span>)</span><br><span class="line">    total_params = <span class="number">0</span></span><br><span class="line">    total_output = <span class="number">0</span></span><br><span class="line">    trainable_params = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> layer <span class="keyword">in</span> summary:</span><br><span class="line">        <span class="comment"># input_shape, output_shape, trainable, nb_params</span></span><br><span class="line">        line_new = <span class="string">"{:>20}  {:>25} {:>15}"</span>.format(</span><br><span class="line">            layer,</span><br><span class="line">            str(summary[layer][<span class="string">"output_shape"</span>]),</span><br><span class="line">            <span class="string">"{0:,}"</span>.format(summary[layer][<span class="string">"nb_params"</span>]),</span><br><span class="line">        )</span><br><span class="line">        total_params += summary[layer][<span class="string">"nb_params"</span>]</span><br><span class="line">        total_output += np.prod(summary[layer][<span class="string">"output_shape"</span>])</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"trainable"</span> <span class="keyword">in</span> summary[layer]:</span><br><span class="line">            <span class="keyword">if</span> summary[layer][<span class="string">"trainable"</span>] == <span class="literal">True</span>:</span><br><span class="line">                trainable_params += summary[layer][<span class="string">"nb_params"</span>]</span><br><span class="line">        outString += <span class="string">"{}\n"</span>.format(line_new)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># assume 4 bytes/number (float on cuda).</span></span><br><span class="line">    total_input_size = abs(np.prod(input_size) * batch_size * <span class="number">4.</span> / (<span class="number">1024</span> ** <span class="number">2.</span>))</span><br><span class="line">    total_output_size = abs(<span class="number">2.</span> * total_output * <span class="number">4.</span> / (<span class="number">1024</span> ** <span class="number">2.</span>))  <span class="comment"># x2 for gradients</span></span><br><span class="line">    total_params_size = abs(total_params.numpy() * <span class="number">4.</span> / (<span class="number">1024</span> ** <span class="number">2.</span>))</span><br><span class="line">    total_size = total_params_size + total_output_size + total_input_size</span><br><span class="line"></span><br><span class="line">    outString += <span class="string">"{}\n"</span>.format(<span class="string">"================================================================"</span>)</span><br><span class="line">    outString += <span class="string">"{}\n"</span>.format(<span class="string">"Total params: {0:,}"</span>.format(total_params))</span><br><span class="line">    outString += <span class="string">"{}\n"</span>.format(<span class="string">"Trainable params: {0:,}"</span>.format(trainable_params))</span><br><span class="line">    outString += <span class="string">"{}\n"</span>.format(<span class="string">"Non-trainable params: {0:,}"</span>.format(total_params - trainable_params))</span><br><span class="line">    outString += <span class="string">"{}\n"</span>.format(<span class="string">"----------------------------------------------------------------"</span>)</span><br><span class="line">    outString += <span class="string">"{}\n"</span>.format(<span class="string">"Input size (MB): %0.2f"</span> % total_input_size)</span><br><span class="line">    outString += <span class="string">"{}\n"</span>.format(<span class="string">"Forward/backward pass size (MB): %0.2f"</span> % total_output_size)</span><br><span class="line">    outString += <span class="string">"{}\n"</span>.format(<span class="string">"Params size (MB): %0.2f"</span> % total_params_size)</span><br><span class="line">    outString += <span class="string">"{}\n"</span>.format(<span class="string">"Estimated Total Size (MB): %0.2f"</span> % total_size)</span><br><span class="line">    outString += <span class="string">"{}\n"</span>.format(<span class="string">"----------------------------------------------------------------"</span>)</span><br><span class="line">    <span class="keyword">return</span> outString</span><br></pre></td></tr></tbody></table></figure></div>
<blockquote>
<p>示例结果如下</p>
</blockquote>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line">net = models.vgg11(pretrained=<span class="literal">False</span>).cuda()</span><br><span class="line">print(summary(net, (<span class="number">3</span>, <span class="number">32</span>, <span class="number">32</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># ===========================================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="meta">>>> </span>----------------------------------------------------------------</span><br><span class="line"><span class="meta">>>> </span>        Layer (type)               Output Shape         Param <span class="comment">#</span></span><br><span class="line"><span class="meta">>>> </span>================================================================</span><br><span class="line"><span class="meta">>>> </span>            Conv2d<span class="number">-1</span>           [<span class="number">-1</span>, <span class="number">64</span>, <span class="number">32</span>, <span class="number">32</span>]           <span class="number">1</span>,<span class="number">792</span></span><br><span class="line"><span class="meta">>>> </span>              ReLU<span class="number">-2</span>           [<span class="number">-1</span>, <span class="number">64</span>, <span class="number">32</span>, <span class="number">32</span>]               <span class="number">0</span></span><br><span class="line"><span class="meta">>>> </span>         MaxPool2d<span class="number">-3</span>           [<span class="number">-1</span>, <span class="number">64</span>, <span class="number">16</span>, <span class="number">16</span>]               <span class="number">0</span></span><br><span class="line"><span class="meta">>>> </span>            Conv2d<span class="number">-4</span>          [<span class="number">-1</span>, <span class="number">128</span>, <span class="number">16</span>, <span class="number">16</span>]          <span class="number">73</span>,<span class="number">856</span></span><br><span class="line"><span class="meta">>>> </span>              ReLU<span class="number">-5</span>          [<span class="number">-1</span>, <span class="number">128</span>, <span class="number">16</span>, <span class="number">16</span>]               <span class="number">0</span></span><br><span class="line"><span class="meta">>>> </span>         MaxPool2d<span class="number">-6</span>            [<span class="number">-1</span>, <span class="number">128</span>, <span class="number">8</span>, <span class="number">8</span>]               <span class="number">0</span></span><br><span class="line"><span class="meta">>>> </span>            Conv2d<span class="number">-7</span>            [<span class="number">-1</span>, <span class="number">256</span>, <span class="number">8</span>, <span class="number">8</span>]         <span class="number">295</span>,<span class="number">168</span></span><br><span class="line"><span class="meta">>>> </span>              ReLU<span class="number">-8</span>            [<span class="number">-1</span>, <span class="number">256</span>, <span class="number">8</span>, <span class="number">8</span>]               <span class="number">0</span></span><br><span class="line"><span class="meta">>>> </span>            Conv2d<span class="number">-9</span>            [<span class="number">-1</span>, <span class="number">256</span>, <span class="number">8</span>, <span class="number">8</span>]         <span class="number">590</span>,<span class="number">080</span></span><br><span class="line"><span class="meta">>>> </span>             ReLU<span class="number">-10</span>            [<span class="number">-1</span>, <span class="number">256</span>, <span class="number">8</span>, <span class="number">8</span>]               <span class="number">0</span></span><br><span class="line"><span class="meta">>>> </span>        MaxPool2d<span class="number">-11</span>            [<span class="number">-1</span>, <span class="number">256</span>, <span class="number">4</span>, <span class="number">4</span>]               <span class="number">0</span></span><br><span class="line"><span class="meta">>>> </span>           Conv2d<span class="number">-12</span>            [<span class="number">-1</span>, <span class="number">512</span>, <span class="number">4</span>, <span class="number">4</span>]       <span class="number">1</span>,<span class="number">180</span>,<span class="number">160</span></span><br><span class="line"><span class="meta">>>> </span>             ReLU<span class="number">-13</span>            [<span class="number">-1</span>, <span class="number">512</span>, <span class="number">4</span>, <span class="number">4</span>]               <span class="number">0</span></span><br><span class="line"><span class="meta">>>> </span>           Conv2d<span class="number">-14</span>            [<span class="number">-1</span>, <span class="number">512</span>, <span class="number">4</span>, <span class="number">4</span>]       <span class="number">2</span>,<span class="number">359</span>,<span class="number">808</span></span><br><span class="line"><span class="meta">>>> </span>             ReLU<span class="number">-15</span>            [<span class="number">-1</span>, <span class="number">512</span>, <span class="number">4</span>, <span class="number">4</span>]               <span class="number">0</span></span><br><span class="line"><span class="meta">>>> </span>        MaxPool2d<span class="number">-16</span>            [<span class="number">-1</span>, <span class="number">512</span>, <span class="number">2</span>, <span class="number">2</span>]               <span class="number">0</span></span><br><span class="line"><span class="meta">>>> </span>           Conv2d<span class="number">-17</span>            [<span class="number">-1</span>, <span class="number">512</span>, <span class="number">2</span>, <span class="number">2</span>]       <span class="number">2</span>,<span class="number">359</span>,<span class="number">808</span></span><br><span class="line"><span class="meta">>>> </span>             ReLU<span class="number">-18</span>            [<span class="number">-1</span>, <span class="number">512</span>, <span class="number">2</span>, <span class="number">2</span>]               <span class="number">0</span></span><br><span class="line"><span class="meta">>>> </span>           Conv2d<span class="number">-19</span>            [<span class="number">-1</span>, <span class="number">512</span>, <span class="number">2</span>, <span class="number">2</span>]       <span class="number">2</span>,<span class="number">359</span>,<span class="number">808</span></span><br><span class="line"><span class="meta">>>> </span>             ReLU<span class="number">-20</span>            [<span class="number">-1</span>, <span class="number">512</span>, <span class="number">2</span>, <span class="number">2</span>]               <span class="number">0</span></span><br><span class="line"><span class="meta">>>> </span>        MaxPool2d<span class="number">-21</span>            [<span class="number">-1</span>, <span class="number">512</span>, <span class="number">1</span>, <span class="number">1</span>]               <span class="number">0</span></span><br><span class="line"><span class="meta">>>> </span>AdaptiveAvgPool2d<span class="number">-22</span>            [<span class="number">-1</span>, <span class="number">512</span>, <span class="number">7</span>, <span class="number">7</span>]               <span class="number">0</span></span><br><span class="line"><span class="meta">>>> </span>           Linear<span class="number">-23</span>                 [<span class="number">-1</span>, <span class="number">4096</span>]     <span class="number">102</span>,<span class="number">764</span>,<span class="number">544</span></span><br><span class="line"><span class="meta">>>> </span>             ReLU<span class="number">-24</span>                 [<span class="number">-1</span>, <span class="number">4096</span>]               <span class="number">0</span></span><br><span class="line"><span class="meta">>>> </span>          Dropout<span class="number">-25</span>                 [<span class="number">-1</span>, <span class="number">4096</span>]               <span class="number">0</span></span><br><span class="line"><span class="meta">>>> </span>           Linear<span class="number">-26</span>                 [<span class="number">-1</span>, <span class="number">4096</span>]      <span class="number">16</span>,<span class="number">781</span>,<span class="number">312</span></span><br><span class="line"><span class="meta">>>> </span>             ReLU<span class="number">-27</span>                 [<span class="number">-1</span>, <span class="number">4096</span>]               <span class="number">0</span></span><br><span class="line"><span class="meta">>>> </span>          Dropout<span class="number">-28</span>                 [<span class="number">-1</span>, <span class="number">4096</span>]               <span class="number">0</span></span><br><span class="line"><span class="meta">>>> </span>           Linear<span class="number">-29</span>                 [<span class="number">-1</span>, <span class="number">1000</span>]       <span class="number">4</span>,<span class="number">097</span>,<span class="number">000</span></span><br><span class="line"><span class="meta">>>> </span>================================================================</span><br><span class="line"><span class="meta">>>> </span>Total params: <span class="number">132</span>,<span class="number">863</span>,<span class="number">336</span></span><br><span class="line"><span class="meta">>>> </span>Trainable params: <span class="number">132</span>,<span class="number">863</span>,<span class="number">336</span></span><br><span class="line"><span class="meta">>>> </span>Non-trainable params: <span class="number">0</span></span><br><span class="line"><span class="meta">>>> </span>----------------------------------------------------------------</span><br><span class="line"><span class="meta">>>> </span>Input size (MB): <span class="number">0.01</span></span><br><span class="line"><span class="meta">>>> </span>Forward/backward <span class="keyword">pass</span> size (MB): <span class="number">2.94</span></span><br><span class="line"><span class="meta">>>> </span>Params size (MB): <span class="number">506.83</span></span><br><span class="line"><span class="meta">>>> </span>Estimated Total Size (MB): <span class="number">509.78</span></span><br><span class="line"><span class="meta">>>> </span>----------------------------------------------------------------</span><br></pre></td></tr></tbody></table></figure></div>
<h1 id="trainvalidate-template"><a class="markdownIt-Anchor" href="#trainvalidate-template"></a> Train/Validate Template</h1>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> pickle <span class="keyword">as</span> pkl</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">train_val</span><span class="params">(net, optimizer, n_epochs, trainBS, valBS, trainDataset, trainLoader, valDataset, valLoader, expLrScheduler, modelPath, modelName)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    net (torchvision.models) : Net model for training/validation</span></span><br><span class="line"><span class="string">    optimizer (torch.optim) : Optimizer for training</span></span><br><span class="line"><span class="string">    n_epochs (int) : Training epochs</span></span><br><span class="line"><span class="string">    trainBS (int) : Training batchsize</span></span><br><span class="line"><span class="string">    valBS (int) : Validation batchsize</span></span><br><span class="line"><span class="string">    trainDataset (torch.Dataset)</span></span><br><span class="line"><span class="string">    trainLoader (torch.DataLoader)</span></span><br><span class="line"><span class="string">    valDataset (torch.Dataset)</span></span><br><span class="line"><span class="string">    valLoader (torch.DataLoader)</span></span><br><span class="line"><span class="string">    expLrScheduler (torch.optim.lr_scheduler) : Learning rate decay strategy</span></span><br><span class="line"><span class="string">    modelPath (str) : Path to save the learnt model</span></span><br><span class="line"><span class="string">    modelName (str) : Model name</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    lossLog = dict({<span class="string">'train'</span>: [], <span class="string">'val'</span>: []})</span><br><span class="line">    accLog = dict({<span class="string">'train'</span>: [], <span class="string">'val'</span>: []})</span><br><span class="line">    dataSet = {<span class="string">'train'</span>: trainDataset, <span class="string">'val'</span>: valDataset}</span><br><span class="line">    dataLoader = {<span class="string">'train'</span>: trainLoader, <span class="string">'val'</span>: valLoader}</span><br><span class="line">    dataSize = {x: dataSet[x].__len__() <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="string">'train'</span>, <span class="string">'val'</span>]}</span><br><span class="line">    batchSize = {<span class="string">'train'</span>: trainBS, <span class="string">'val'</span>: valBS}</span><br><span class="line">    iterNum = {x: np.ceil(dataSize[x] / batchSize[x]).astype(<span class="string">'int32'</span>) <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="string">'train'</span>, <span class="string">'val'</span>]}</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'dataSize: {}'</span>.format(dataSize))</span><br><span class="line">    print(<span class="string">'batchSize: {}'</span>.format(batchSize))</span><br><span class="line">    print(<span class="string">'iterNum: {}'</span>.format(iterNum))</span><br><span class="line"></span><br><span class="line">    best_acc = <span class="number">0.0</span></span><br><span class="line">    start = time.time()</span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> tqdm(range(n_epochs), desc=<span class="string">'Epoch'</span>):  <span class="comment"># loop over the dataset multiple times</span></span><br><span class="line">        print(<span class="string">'Epoch {}/{}, lr = {}  [best_acc = {:.4f}%]'</span>.format(epoch+<span class="number">1</span>, n_epochs, optimizer.param_groups[<span class="number">0</span>][<span class="string">'lr'</span>], best_acc))</span><br><span class="line">        print(<span class="string">'-'</span> * <span class="number">10</span>)</span><br><span class="line">        epochStart = time.time()</span><br><span class="line">        <span class="keyword">for</span> phase <span class="keyword">in</span> [<span class="string">'train'</span>, <span class="string">'val'</span>]:</span><br><span class="line">            <span class="keyword">if</span>(phase == <span class="string">'train'</span>):</span><br><span class="line">                expLrScheduler.step() <span class="comment"># Update learning_rate</span></span><br><span class="line">                net.train()  <span class="comment"># Set model to training mode</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                net.eval()   <span class="comment"># Set model to evaluate mode</span></span><br><span class="line">            losses = AverageMeter() <span class="comment"># Init AverageMeter for loss</span></span><br><span class="line">            top1 = AverageMeter() <span class="comment"># Init AverageMeter for top1 accuracy</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> i, data <span class="keyword">in</span> enumerate(dataLoader[phase], <span class="number">0</span>):</span><br><span class="line">                inputs, labels = data</span><br><span class="line">                inputs = inputs.cuda()</span><br><span class="line">                labels = labels.cuda()</span><br><span class="line">                <span class="keyword">with</span> torch.set_grad_enabled(phase == <span class="string">'train'</span>):</span><br><span class="line">                    <span class="comment"># Feed forward</span></span><br><span class="line">                    outputs = net(inputs)</span><br><span class="line">                    loss = criterion(outputs, labels)</span><br><span class="line"></span><br><span class="line">                    <span class="comment"># Feed backward</span></span><br><span class="line">                    <span class="keyword">if</span>(phase == <span class="string">'train'</span>):</span><br><span class="line">                        optimizer.zero_grad()</span><br><span class="line">                        loss.backward()</span><br><span class="line">                        optimizer.step()</span><br><span class="line"></span><br><span class="line">                losses.update(loss.item()*inputs.size(<span class="number">0</span>), inputs.size(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 实现刷新的效果 (/r)</span></span><br><span class="line">                sys.stdout.write(<span class="string">'                                                                                                  \r'</span>)</span><br><span class="line">                sys.stdout.flush()</span><br><span class="line">                <span class="comment"># Calculate top1 accuracy for single-label classification</span></span><br><span class="line">                prec1 = accuracy(outputs, torch.argmax(labels, <span class="number">1</span>), topk=(<span class="number">1</span>,))[<span class="number">0</span>]</span><br><span class="line">                top1.update(prec1.item(), inputs.size(<span class="number">0</span>))</span><br><span class="line">                sys.stdout.write(<span class="string">'Iter: {} / {} ({:.0f}s)\tLoss= {:.4f} ({:.4f})\tAcc= {:.2f}% ({:.0f}/{:.0f})\r'</span></span><br><span class="line">                     .format(i+<span class="number">1</span>, iterNum[phase], time.time() - epochStart, loss.item(), losses.avg, prec1/inputs.size(<span class="number">0</span>)*<span class="number">100</span>, top1.sum, top1.count))</span><br><span class="line">                sys.stdout.flush()</span><br><span class="line">            <span class="comment"># 实现刷新的效果 (/r)</span></span><br><span class="line">            sys.stdout.write(<span class="string">'                                                                                                  \r'</span>)</span><br><span class="line">            sys.stdout.flush()</span><br><span class="line"></span><br><span class="line">            epoch_loss = losses.avg</span><br><span class="line">            epoch_acc = top1.avg*<span class="number">100</span></span><br><span class="line">            accLog[phase].append(epoch_acc/<span class="number">100</span>)</span><br><span class="line">            lossLog[phase].append(epoch_loss)</span><br><span class="line">            epochDuration = time.time() - epochStart</span><br><span class="line">            epochStart = time.time()</span><br><span class="line">            hour, minute, second = convert_secs2time(epochDuration)</span><br><span class="line">            print(<span class="string">'[ {} ]  Loss: {:.4f} Acc: {:.3f}% ({:.0f}/{:.0f}) ({:.0f}h {:.0f}m {:.2f}s)'</span></span><br><span class="line">                .format(phase, epoch_loss, epoch_acc, top1.sum, top1.count, hour, minute, second))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Save models</span></span><br><span class="line">            <span class="keyword">if</span>(phase == <span class="string">'val'</span> <span class="keyword">and</span> epoch_acc > best_acc):</span><br><span class="line">                print(<span class="string">'Saving best model to {}'</span>.format(os.path.join(modelPath, modelName)))</span><br><span class="line">                state = {<span class="string">'net'</span>: net.state_dict(), <span class="string">'opt'</span>: optimizer, <span class="string">'acc'</span>: epoch_acc, <span class="string">'epoch'</span>: epoch, <span class="string">'classes'</span>: classes}</span><br><span class="line">                torch.save(state, os.path.join(modelPath, modelName))</span><br><span class="line">                best_acc = epoch_acc</span><br><span class="line">            <span class="keyword">if</span>(phase == <span class="string">'val'</span> <span class="keyword">and</span> epoch == n_epochs - <span class="number">1</span>):</span><br><span class="line">                finalModelName = <span class="string">'final-{}'</span>.format(modelName)</span><br><span class="line">                print(<span class="string">'Saving final model to {}'</span>.format(os.path.join(modelPath, finalModelName)))</span><br><span class="line">                state = {<span class="string">'net'</span>: net.state_dict(), <span class="string">'opt'</span>: optimizer, <span class="string">'acc'</span>: epoch_acc, <span class="string">'epoch'</span>: epoch, <span class="string">'classes'</span>: classes}</span><br><span class="line">                torch.save(state, os.path.join(modelPath, finalModelName))</span><br><span class="line">        print(<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Save logs</span></span><br><span class="line">        log = dict({<span class="string">'acc'</span>: accLog, <span class="string">'loss'</span>: lossLog})</span><br><span class="line">        <span class="keyword">with</span> open(os.path.join(modelPath, <span class="string">'log.pkl'</span>), <span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            pkl.dump(log, f)</span><br><span class="line">            <span class="keyword">if</span>(epoch + <span class="number">1</span> == n_epochs):</span><br><span class="line">                print(<span class="string">"Training logs saved to : {}"</span>.format(os.path.join(modelPath, <span class="string">'log.pkl'</span>)))</span><br><span class="line">        plot_acc_loss(log, <span class="string">'both'</span>, modelPath, <span class="string">'{}_'</span>.format(modelName), <span class="string">''</span>, (epoch + <span class="number">1</span> == n_epochs))</span><br><span class="line">        plot_acc_loss(log, <span class="string">'loss'</span>, modelPath, <span class="string">'{}_'</span>.format(modelName), <span class="string">''</span>, (epoch + <span class="number">1</span> == n_epochs))</span><br><span class="line">        plot_acc_loss(log, <span class="string">'accuracy'</span>, modelPath, <span class="string">'{}_'</span>.format(modelName), <span class="string">''</span>, (epoch + <span class="number">1</span> == n_epochs))</span><br><span class="line">    duration = time.time() - start</span><br><span class="line">    print(<span class="string">'Training complete in {:.0f}h {:.0f}m {:.2f}s'</span>.format(duration // <span class="number">3600</span>, (duration % <span class="number">3600</span>) // <span class="number">60</span>, duration % <span class="number">60</span>))</span><br><span class="line">    print(<span class="string">'Best val Acc: {:4f}'</span>.format(best_acc))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> best_acc</span><br><span class="line"></span><br><span class="line"><span class="comment"># ===========================================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#---- Create Dataset and DataLoader ----#</span></span><br><span class="line">trainBS = <span class="number">100</span></span><br><span class="line">testBS = <span class="number">100</span></span><br><span class="line">myTransform = transforms.Compose([</span><br><span class="line">    transforms.ToTensor(),</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">trainDataset = myDataset(trainImage, torch.Tensor(trainLabel).long(), classes, transform=myTransform, to_onehot=<span class="literal">True</span>)</span><br><span class="line">trainLoader = DataLoader(trainDataset, batch_size=trainBS, shuffle=<span class="literal">True</span>, num_workers=<span class="number">8</span>)</span><br><span class="line">testDataset = myDataset(testImage, torch.Tensor(testLabel).long(), classes, transform=myTransform, to_onehot=<span class="literal">True</span>)</span><br><span class="line">testLoader = DataLoader(testDataset, batch_size=testBS, shuffle=<span class="literal">False</span>, num_workers=<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#---- Create model ----#</span></span><br><span class="line">net = models.resnet18(pretrained=<span class="literal">False</span>)</span><br><span class="line">fc_features = net.fc.in_features</span><br><span class="line">net.fc = nn.Linear(fc_features, len(classes))</span><br><span class="line">net.avgpool = nn.AdaptiveAvgPool2d((<span class="number">1</span>, <span class="number">1</span>))</span><br><span class="line">net = net.cuda()</span><br><span class="line"></span><br><span class="line"><span class="comment">#---- Set training strategies ----#</span></span><br><span class="line">lr = <span class="number">0.1</span></span><br><span class="line">momentum = <span class="number">0.9</span></span><br><span class="line">weightDecay = <span class="number">5e-4</span></span><br><span class="line">criterion = myLoss().cuda()</span><br><span class="line">optimizer = optim.SGD(net.parameters(), lr=lr, momentum=momentum, weight_decay=weightDecay, nesterov=<span class="literal">True</span>)</span><br><span class="line">expLrScheduler = optim.lr_scheduler.MultiStepLR(optimizer, [<span class="number">50</span>, <span class="number">75</span>], gamma=<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line">modelPath = <span class="string">'xxxxxxxxxxxxxx/pytorch_model_learnt'</span></span><br><span class="line">modelName = <span class="string">'resnet18.ckpt'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#---- Start training and validation ----#</span></span><br><span class="line">best_acc = train_val( net,</span><br><span class="line">                      optimizer, </span><br><span class="line">                      <span class="number">10</span>, </span><br><span class="line">                      trainBS,</span><br><span class="line">                      testBS,</span><br><span class="line">                      trainDataset, </span><br><span class="line">                      trainLoader, </span><br><span class="line">                      testDataset, </span><br><span class="line">                      testLoader,</span><br><span class="line">                      expLrScheduler,</span><br><span class="line">                      modelPath,</span><br><span class="line">                      modelName)</span><br></pre></td></tr></tbody></table></figure></div>
<h1 id="evaluation-template"><a class="markdownIt-Anchor" href="#evaluation-template"></a> Evaluation Template</h1>
<div class="code-area-wrap"><div class="highlight-tools"><i class="fa fa-angle-down code-expand" aria-hidden="true"></i><div class="code_lang">python</div><div class="copy-notice"></div><i class="fa fa-clipboard" aria-hidden="true"></i></div><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_labels_and_pres</span><span class="params">(net, dataLoader)</span>:</span></span><br><span class="line">    l, p = [], []</span><br><span class="line">    <span class="keyword">with</span> torch.no_grad():</span><br><span class="line">        <span class="keyword">for</span> data <span class="keyword">in</span> dataLoader:</span><br><span class="line">            images, labels = data</span><br><span class="line">            images = images.cuda()</span><br><span class="line">            labels = labels.cuda()</span><br><span class="line">            outputs = net(images)</span><br><span class="line">            predicted = torch.argmax(outputs.data, <span class="number">1</span>)</span><br><span class="line">            labels = torch.argmax(labels.data, <span class="number">1</span>)</span><br><span class="line">            p.extend(predicted.cpu().numpy())</span><br><span class="line">            l.extend(labels.cpu().numpy())</span><br><span class="line">    <span class="keyword">return</span> l, p</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eval_total</span><span class="params">(labels, preds)</span>:</span></span><br><span class="line">    start = time.time()</span><br><span class="line">    </span><br><span class="line">    total = len(labels)</span><br><span class="line">    correct = np.equal(labels, preds).sum()</span><br><span class="line">    </span><br><span class="line">    accTotal = <span class="number">100</span> * correct / total</span><br><span class="line">    duration = time.time() - start</span><br><span class="line">    print(<span class="string">'Accuracy of the network on the {} test images: {:.2f}% ({:.0f}mins {:.2f}s)'</span>.format(total, accTotal, duration // <span class="number">60</span>, duration % <span class="number">60</span>))</span><br><span class="line">    <span class="keyword">return</span> accTotal</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">eval_per_class</span><span class="params">(labels, preds, classes)</span>:</span></span><br><span class="line">    num_classes = len(classes)</span><br><span class="line">    start = time.time()</span><br><span class="line">    class_correct = list(<span class="number">0.</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(num_classes))</span><br><span class="line">    class_total = list(<span class="number">0.</span> <span class="keyword">for</span> i <span class="keyword">in</span> range(num_classes))</span><br><span class="line"></span><br><span class="line">    c = np.equal(labels, preds)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(c)):</span><br><span class="line">        label = labels[i]</span><br><span class="line">        class_correct[label] += c[i]</span><br><span class="line">        class_total[label] += <span class="number">1</span></span><br><span class="line">    print(<span class="string">'class_correct\t:\t{}'</span>.format(class_correct))</span><br><span class="line">    print(<span class="string">'class_total\t:\t{}'</span>.format(class_total))</span><br><span class="line">    accPerClass = dict()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(num_classes):</span><br><span class="line">        accPerClass[classes[i]] = <span class="number">0</span> <span class="keyword">if</span> class_correct[i] == <span class="number">0</span> <span class="keyword">else</span> <span class="string">'{:.2f}%'</span>.format(<span class="number">100</span> * class_correct[i] / class_total[i])</span><br><span class="line">    duration = time.time() - start</span><br><span class="line">    print(<span class="string">'Per class accuracy :'</span>)</span><br><span class="line">    print(accPerClass)</span><br><span class="line">    print(<span class="string">'Duration for accPerClass : {:.0f}mins {:.2f}s'</span>.format(duration // <span class="number">60</span>, duration % <span class="number">60</span>))</span><br><span class="line">    <span class="keyword">return</span> accPerClass</span><br><span class="line"></span><br><span class="line"><span class="comment"># ===========================================================================================</span></span><br><span class="line"></span><br><span class="line">ckpt = torch.load(os.path.join(modelPath, modelName))</span><br><span class="line">net = ResNet18(num_classes=len(classes), input_shape=(<span class="number">3</span>, imageSize, imageSize))</span><br><span class="line">net.load_state_dict(ckpt[<span class="string">'net'</span>])</span><br><span class="line">net = net.cuda()</span><br><span class="line">**net.eval()**</span><br><span class="line">classList = ckpt[<span class="string">'classes'</span>]</span><br><span class="line"></span><br><span class="line">labels, preds = get_labels_and_pres(net, testLoader)</span><br><span class="line">accTotal = eval_total(labels, preds)</span><br><span class="line">accPerClass = eval_per_class(labels, preds, classList)</span><br></pre></td></tr></tbody></table></figure></div></body></html></div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Reborn</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://reborn8888.github.io/2020/02/14/pytorch%E7%AC%94%E8%AE%B0/">https://reborn8888.github.io/2020/02/14/pytorch%E7%AC%94%E8%AE%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://ReBoRn8888.github.io">Reborn</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/python/">python    </a><a class="post-meta__tags" href="/tags/pytorch/">pytorch    </a><a class="post-meta__tags" href="/tags/DL/">DL    </a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/02/14/YXEOI3Txj7HJqRa.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://i.loli.net/2019/12/08/sLmoV1atujlQPRY.png" alt="微信"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lazyload post-qr-code__img" src="https://i.loli.net/2019/12/08/HhJfxq64XDn3LMK.png" alt="支付寶"><div class="post-qr-code__desc">支付寶</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/03/02/gitIssues/"><img class="prev_cover lazyload" data-src="https://i.loli.net/2020/03/02/vO8bI5LnMUjJwlH.png" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>git Issues</span></div></a></div><div class="next-post pull_right"><a href="/2020/02/14/sklearn%E7%AC%94%E8%AE%B0/"><img class="next_cover lazyload" data-src="https://i.loli.net/2020/02/14/8e36MDvRhumIkZO.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>sklearn 笔记</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/04/09/python笔记/" title="python 笔记"><img class="relatedPosts_cover lazyload"data-src="https://i.loli.net/2020/04/09/kbxQSLTBHNRJfsr.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-09-14</div><div class="relatedPosts_title">python 笔记</div></div></a></div><div class="relatedPosts_item"><a href="/2020/03/21/《Color-Transfer-between-Images》Python代码实现/" title="《Color_Transfer_between_Images》Python代码实现"><img class="relatedPosts_cover lazyload"data-src="https://i.loli.net/2020/03/21/goGBmrjybwk1nOv.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-09-14</div><div class="relatedPosts_title">《Color_Transfer_between_Images》Python代码实现</div></div></a></div><div class="relatedPosts_item"><a href="/2020/03/16/pip笔记/" title="pip 笔记"><img class="relatedPosts_cover lazyload"data-src="https://i.loli.net/2020/03/16/Dpn9cQAdxwrtg37.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-09-14</div><div class="relatedPosts_title">pip 笔记</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/14/sklearn笔记/" title="sklearn 笔记"><img class="relatedPosts_cover lazyload"data-src="https://i.loli.net/2020/02/14/8e36MDvRhumIkZO.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-09-14</div><div class="relatedPosts_title">sklearn 笔记</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/14/plt&cv2笔记/" title="plt&cv2 笔记"><img class="relatedPosts_cover lazyload"data-src="https://i.loli.net/2020/02/14/lgWzFDvHry8bsdB.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-09-14</div><div class="relatedPosts_title">plt&cv2 笔记</div></div></a></div><div class="relatedPosts_item"><a href="/2019/12/26/激活函数/" title="激活函数"><img class="relatedPosts_cover lazyload"data-src="https://i.loli.net/2020/01/29/Ac2ZVNXBoKrdI8O.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-09-14</div><div class="relatedPosts_title">激活函数</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = false == true ? true : false;
var verify = false == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;

window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'2boKvi6UsSeUABpVH99z87cj-gzGzoHsz',
  appKey:'instDcdLyY9Ace9gcgI1eQh3',
  placeholder:'Please leave your footprints',
  avatar:'monsterid',
  guest_info:guest_info,
  pageSize:'10',
  lang:'en',
  recordIP: true
});</script></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By Reborn</div><div class="framework-info"><span>驱动 </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi, welcome to my <u><a href="https://reborn8888.github.io/">Blog</a></u>!</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">簡</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script>$(function () {
  $('span.katex-display').wrap('<div class="katex-wrap"></div>')
})</script><script id="ribbon_piao" mobile="false" src="https://cdn.jsdelivr.net/gh/jerryc127/butterfly_cdn@2.1.0/js/piao.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>